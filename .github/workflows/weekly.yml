name: Weekly Wire

on:
  schedule:
    - cron: "25 19 * * TUE" # 2:25 PM America/Chicago (CDT) = 7:25 PM UTC-5
  workflow_dispatch: {}

jobs:
  run:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with: { node-version: 20 }
      - run: npm ci --omit=dev
      - name: Run Weekly Wire
        env:
          MAILCHIMP_API_KEY: ${{ secrets.MAILCHIMP_API_KEY }}
          MAILCHIMP_LIST_ID: ${{ secrets.MAILCHIMP_LIST_ID }}
          GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
          PCO_PAT_ID: ${{ secrets.PCO_PAT_ID }}
          PCO_PAT_SECRET: ${{ secrets.PCO_PAT_SECRET }}
          MC_FROM_NAME: ${{ secrets.MC_FROM_NAME }}
          MC_REPLY_TO: ${{ secrets.MC_REPLY_TO }}
          YT_CHANNEL_ID: ${{ secrets.YT_CHANNEL_ID }}
          YT_API_KEY: ${{ secrets.YT_API_KEY }}
          CALENDAR_ICS: ${{ secrets.CALENDAR_ICS }}
          NODE_ENV: production
        run: npm start
